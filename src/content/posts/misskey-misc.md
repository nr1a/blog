---
title: Misskeyサーバーの設定, 私のおすすめ設定
published: 2024-07-31
description: Misskeyサーバーを立てるときの私のおすすめ設定を紹介します。
tags: [Misskey, Cloudflare]
category: Misskey
draft: false
---

### 私です

普段Misskeyを立てるとき、どんな設定をしているのか君たちに教えようと思います。

## Misskeyの設定に入る前に

MisskeyってCloudflareを通していれば安全だと思っていませんか？実はそれは間違いで、相手のサーバーに投稿する際に`https://misskey.io/inbox`にPOSTすることがあります。これでは相手から見るとIPアドレスが漏れてしまいます。

適当なVPNやプロキシを使うのもいいですが、Cloudflareを使っているならCloudflare WARPを使いましょう。適当に登録した後、`warp-cli connect`とやるだけです。

Cloudflared tunnelとはあまり相性はよくないですが、これでセキュリティが一段階高まります。

余談ですが、WARPでもtunnelは通せますが、未だにIPv6には対応していません（別にいらないけど）。気持ち的にはIPv6があったらいいな〜という思いで、WARP→Cloudflared tunnelという運用方法をしています。絶対不安定になるだけなので、こだわりがないならWARPでtunnelを通してください。

## 全般

鯖を立てたら最初にサーバー名を入れます。最近は絵文字や略称で日本語名を入れています。管理者の名前やメールアドレスも一緒に入れますが、メールアドレスは悪用されがちなので、余計なかっこを入れたりします（意味ないけど）。

あとは、リポジトリURLを変えたり、リモートファイルのキャッシュを有効にします。オブジェクトストレージを使わないならキャッシュは切ったほうがいいです。

通知は普段使わないけど、ServiceWorkerは有効にしています。URLプレビューはCloudflare Workersで動いているサマリープロキシを使っています。

## ブランディング

アイコン、バナー、背景画像を入れています。テーマカラーはInstance Tickerに色がつくので変えています。かわいいし。それぐらいです。

## モデレーション

適当にサーバールールを書いています。

## メールサーバー

Cloudflareでメールを作っているならGmailをサーバーとして使えます。

1. CloudflareでMisskey用にメールを発行しておく（転送先をGmailにする）。
2. 転送先のGmailのアプリケーションパスワードを発行する。
3. Gmailを開いて、設定→アカウントとインポートで他のメールアドレスを追加。メールアドレスにCloudflareで発行したものを入れる。
4. SMTPサーバーに`smtp.gmail.com`、ポートはそのまま。ユーザー名にGmailアカウント、パスワードにアプリケーションパスワードを入力。
5. 追加を押してエイリアス設定を続行し、Googleからのメールを承諾する。
6. Misskeyのメールサーバー設定で、メールアドレス、ホスト（`smtp.gmail.com`）、ポート（`587`）、ユーザー名、パスワードを入力。
7. SSL/TLSは不要。

これで配信テストして成功すれば設定完了です。無料なので強いです。

## オブジェクトストレージ

Cloudflare R2を使っています。10GBまでは無料で早いです。詳しい説明は省きます。

## セキュリティ

BotプロテクションにTurnstileを使っています。センシティブメディアの検出は使わず、Email validationも使いませんが、Banned email domainsは使います。IPのロギングは気分で設定します。

## リレー

DBを無駄に消費するので使いませんが、公開サーバーなら価値があります。

## プロキシアカウント

おひとりさまなら自分を設定すればいいです。公開サーバーはプロキシでアカウントを取って使います。一回発言しないと表示されないのでノートしましょう。

## 外部サービス

DeepLのAPI Keyは無料で使えます。

## Webhook

あまり使っていませんが、自分でコードを組んでモデレーションログをDiscordに流しています。

## その他

全てオフにしておけば負荷が減ります。おひとりさまはマシン情報の公開以外はオフでいいです。

## 終わり

って感じかな。わからないところがあったら聞いてもいいし、調べるのもいいかもね。ほなまた。
